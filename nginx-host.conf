# Nginx Configuration for EC2 Host
# =============================================================================
# Use this if you want to set up Nginx on the EC2 host (not in Docker)
# to serve both old and new apps on the same domain with different paths/subdomains
#
# Install: sudo apt-get install nginx
# Copy to: /etc/nginx/sites-available/p1lending
# Enable:  sudo ln -s /etc/nginx/sites-available/p1lending /etc/nginx/sites-enabled/
# Test:    sudo nginx -t
# Reload:  sudo systemctl reload nginx
# =============================================================================

# Option 1: Different subdomains (Recommended)
# Old app: app.yourdomain.com
# New app: new.yourdomain.com or beta.yourdomain.com

# Old App (keep existing config, example shown)
server {
    listen 80;
    server_name app.yourdomain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;  # Adjust port to match your old Flask app
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# New App
server {
    listen 80;
    server_name new.yourdomain.com beta.yourdomain.com;

    # Frontend (served by Docker container)
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket support
    location /socket.io {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# =============================================================================
# Option 2: Same domain, different path prefix
# Old app: yourdomain.com/
# New app: yourdomain.com/v2/
# =============================================================================

# Uncomment below if you prefer path-based routing:
#
# server {
#     listen 80;
#     server_name yourdomain.com;
#
#     # New app at /v2/
#     location /v2/ {
#         rewrite ^/v2/(.*) /$1 break;
#         proxy_pass http://127.0.0.1:8080;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
#
#     location /v2/socket.io {
#         rewrite ^/v2/(.*) /$1 break;
#         proxy_pass http://127.0.0.1:8080;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#     }
#
#     # Old app at / (default)
#     location / {
#         proxy_pass http://127.0.0.1:5000;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
# }

# =============================================================================
# Option 3: IP-based access during testing (Simplest)
# Access new app directly via: http://your-ec2-ip:8080
# No Nginx config changes needed - just use the port directly
# =============================================================================

